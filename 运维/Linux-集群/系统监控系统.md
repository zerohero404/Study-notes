# 1.常见监控平台
## 1.1 Cacti
- 软件官方网站<br>
&ensp;&ensp;http://www.cacti.net/<br>
- 软件设计目标<br>
&ensp;&ensp;流量与性能监测为主<br>
- 数据展示平台<br>
&ensp;&ensp;B/S<br>
- 数据收集方式<br>
&ensp;&ensp;SNMP（Simple Network Management Protocol）<br>

## 1.2 Nagios
- 软件官方网站<br>
&ensp;&ensp;http://www.nagios.org/<br>
- 软件设计目标<br>
&ensp;&ensp;服务与性能监测为主<br>
- 数据展示平台<br>
&ensp;&ensp;B/S<br>
- 数据收集方式<br>
&ensp;&ensp;SNMP（Simple Network Management Protocol）<br>

## 1.3 Zabbix
- 软件官方网站<br>
&ensp;&ensp;http://www.zabbix.com/<br>
- 软件设计目标<br>
&ensp;&ensp;全功能监控软件<br>
- 数据展示平台<br>
&ensp;&ensp;B/S<br>
- 数据收集方式<br>
&ensp;&ensp;C/S<br>

# 2.监控平台搭建
## 2.1 Cacti 监控服务器
- 组件构成<br>
&ensp;&ensp;组合框架：LAP<br>
&ensp;&ensp;数据收集：SNMP <br>
&ensp;&ensp;绘制图形：RRDtool <br>
- SNMP 收集数据展示图<br>
<img width="507" height="267" alt="Linux：集群_57" src="https://github.com/user-attachments/assets/1ca75912-c7f3-436f-a4f4-6f62ea698bce" /><br>
- RRDtool<br>
&ensp;&ensp;官方定义<br>
&ensp;&ensp;&ensp;&ensp;RRDtool 是开源行业标准，高性能的时间序列数据记录和绘图系统。RRDtool 可以很容易地集成到 shell 脚本、perl、python、ruby、lua 或 tcl 应用程序中<br>
&ensp;&ensp;工作架构<br>
 <img width="332" height="224" alt="Linux：集群_58" src="https://github.com/user-attachments/assets/60410c1b-8dba-4d92-95da-d9ce6e80fc56" /><br>
&ensp;&ensp;C/S  模式<br>
&ensp;&ensp;&ensp;&ensp;采集监测数据<br>
&ensp;&ensp;B/S  模式<br>
&ensp;&ensp;&ensp;&ensp;管理监测数据<br>

## 2.2 cacti 监控搭建
- 监控端<br>
&ensp;&ensp;tar -xf cati.tar<br>
&ensp;&ensp;service iptables stop<br>
&ensp;&ensp;chkconfig iptables off<br>
&ensp;&ensp;yum -y install httpd mysql mysql-server mysql-devel libxml2-devel mysql-connector-odbc perl-DBD-MySQL unixODBC php php-mysql php-pdo   # 安装基础环境 LAMP<br>
&ensp;&ensp;yum -y install net-snmp net-snmp-utils net-snmp-libs lm_sensors  # 安装 SNMP、主板信息监控所需软件包<br>
&ensp;&ensp;service httpd start<br>
&ensp;&ensp;service mysqld start<br>
&ensp;&ensp;mysqladmin -uroot password “123456”<br>
&ensp;&ensp;安装rrdtools（软件包在服务器内）<br>
&ensp;&ensp;&ensp;&ensp;tar -zxf rrdtool-1.4.5.tar.gz<br>
&ensp;&ensp;&ensp;&ensp;cd rrdtool<br>
&ensp;&ensp;&ensp;&ensp;./configure –prefix=/usr/local<br>
&ensp;&ensp;&ensp;&ensp;如出错，按以下步骤解决,此版本需先出错再解决报错，不然安装不上 # 解决源码编译报错依赖<br>
&ensp;&ensp;&ensp;&ensp;cd ../<br>
&ensp;&ensp;&ensp;&ensp;tar zxvf cgilib-0.5.tar.gz<br>
&ensp;&ensp;&ensp;&ensp;cd cgilib-0.5<br>
&ensp;&ensp;&ensp;&ensp;make<br>
&ensp;&ensp;&ensp;&ensp;cp libcgi.a /usr/local/lib<br>
&ensp;&ensp;&ensp;&ensp;cp cgi.h /usr/include<br>
&ensp;&ensp;&ensp;&ensp;yum -y install libart_lgpl-devel pango-devel* cairo-devel* <br>
&ensp;&ensp;&ensp;&ensp;cd ../rrdtool<br>
&ensp;&ensp;&ensp;&ensp;./configure –prefix=/usr/local<br>
&ensp;&ensp;&ensp;&ensp;make && make install<br>
&ensp;&ensp;tar -zxf cacti-0.8.7g.tar.gz # 解压 Cacti 网站<br>
&ensp;&ensp;mv cacti-0.8.7g/ /var/www/html/cacti # 拷贝至 Apache 默认路径<br>
&ensp;&ensp;cd /var/www/html/cacti # 为 Cacti 代码进行补丁更新<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/data_source_deactivate.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/graph_list_view.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/html_output.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/ldap_group_authenication.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/script_server_command_line_parse.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/ping.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/poller_interval.patch<br>
&ensp;&ensp;useradd runct  # 添加 runct 用户，用于 RRDTOOL 运行<br>
&ensp;&ensp;chown -R root.root /var/www/html/cacti<br>
&ensp;&ensp;chown -R runct.runct rra/ log/ # 添加检测数据的用户账户，更改权限，保证读写数据正常<br>
&ensp;&ensp;mysql -u root -p # 授权数据库用户,导入初始化数据<br>
&ensp;&ensp;&ensp;&ensp;mysql> create database cactidb default character set utf8; # 创建 cactidb 数据库<br>
&ensp;&ensp;&ensp;&ensp;mysql> grant all on cactidb.* to ‘cactiuser’@’localhost’ identified by ‘123456（密码可以自己设置）’;  # 把 cactiuser 用户赋予 cactidb 库的所有权限<br>
&ensp;&ensp;&ensp;&ensp;mysql> exit<br>
&ensp;&ensp;&ensp;&ensp;mysql -u cactiuser -p cactidb < cacti.sql<br>
&ensp;&ensp;然后输入你给 cactiuser 用户设置的密码<br>
&ensp;&ensp;vim include/config.php #修改 cacti 配置文件，配置 cacti 页面连接数据库的认证信息<br>

```bash
$database_type = “mysql”;
$database_default = “cactidb（你创建的数据库名）”;
$database_hostname = “localhost”;
$database_username = “cactiuser”;
# 你创建的 mysql 的 cacti 用户名
$database_password = “123456789”;
# 你创建的 mysql 的 cacti 用户密码
$database_port = “3306”;
# 连接端口
```
&ensp;&ensp;vim /etc/httpd/conf/httpd.conf<br> # 配置 Apache 对 cacti 的用户权限<br>
&ensp;&ensp;&ensp;&ensp;Listen 80 # 监听端口<br>
<img width="492" height="137" alt="Linux：集群_60" src="https://github.com/user-attachments/assets/d9ac7652-2b1f-454b-9fab-f1c18facd508" /><br>
&ensp;&ensp;&ensp;&ensp;DocumentRoot "/var/www/html/cacti" # 调整 Apache 默认加载路径<br>
<img width="515" height="82" alt="Linux：集群_61" src="https://github.com/user-attachments/assets/a71ce0dd-9d13-4ed6-988c-8f33ffeb462f" /><br>
&ensp;&ensp;<Directory "/var/www/html/cacti"><br>
<img width="438" height="52" alt="Linux：集群_62" src="https://github.com/user-attachments/assets/80d43f2f-2671-4656-b855-7fe89e55f3ee" /><br>
&ensp;&ensp;DirectoryIndex index.php index.html index.html.var # 修改默认加载选项<br>
<img width="475" height="85" alt="Linux：集群_63" src="https://github.com/user-attachments/assets/4ceb34fc-2889-4c9e-ad6b-42d772591b4a" /><br>
&ensp;&ensp;AddDefaultCharset utf-8<br>
&ensp;&ensp;service httpd restart
&ensp;&ensp;然后再浏览器输入 http://cacti 监控端 IP 地址/install 进行安装<br>

- 被监控端<br>
&ensp;&ensp;yum -y install net-snmp net-snmp-utils lm_sensors # 安装 SNMP、主板信息监控所需软件包<br>
&ensp;&ensp;vim /etc/snmp/snmpd.conf # 修改 snmp 配置文件<br>
&ensp;&ensp;修改共同体名称<br>
<img width="359" height="53" alt="Linux：集群_64" src="https://github.com/user-attachments/assets/507bb149-eaeb-43a7-a4e2-a01b808675b0" /><br>

&ensp;&ensp;开放所有的 SNMP 查询权限 all 默认为 SystemView<br>
<img width="551" height="41" alt="Linux：集群_65" src="https://github.com/user-attachments/assets/b139ee39-10ef-4bc1-b0e1-f02c03806460" /><br>

&ensp;&ensp;支持各种查询与访问，取消注释符号<br>
<img width="435" height="31" alt="Linux：集群_66" src="https://github.com/user-attachments/assets/cc719bda-9b75-4cf8-ada4-f22474c5e357" /><br>

- 回到监控端<br>
&ensp;&ensp;snmpwalk -v 2c -c public123（共同体名称） 10.10.10.12（被监控端 IP 地址） tcp<br>
&ensp;&ensp;php /var/www/html/cacti/poller.php # 生成对应的监控图表<br>
&ensp;&ensp;crontab -e<br>
&ensp;&ensp;*/5 * * * * /usr/bin/php /var/www/html/cacti/poller.php &>/dev/null # 配置 RRDTOOL 的轮训任务<br>
&ensp;&ensp;service crond start<br>

- Cacti 部署插件管理器<br>
&ensp;&ensp;cd /root/cacti-plugin（cicti.tar 文件解压的位置）<br>
&ensp;&ensp;tar -xf cacti-plugin-0.8.7g-PA-v2.8.tar.gz<br>
&ensp;&ensp;cd cacti-plugin-arch/<br>
&ensp;&ensp;mysql -uroot -p cactidb < pa.sql<br>
&ensp;&ensp;cd /var/www/html/cacti/<br>
&ensp;&ensp;patch -p1 -N </root/cacti-plugin（cicti.tar 文件解压的位置）/cacti-plugin-arch/cacti-plugin-0.8.7g-PA-v2.8.diff<br>
&ensp;&ensp;插件文件存放位置：/var/www/html/cacti/plugins<br>
&ensp;&ensp;浏览器登录 cacti 网页管理器<br>
&ensp;&ensp;&ensp;&ensp;点击 Console 然后 再点击 User Management<br>
<img width="266" height="591" alt="Linux：集群_67" src="https://github.com/user-attachments/assets/86d1f537-683e-49a8-9d35-62e2d3fe6f2e" /><br>

&ensp;&ensp;勾选 Plugin Management<br>
<img width="930" height="815" alt="Linux：集群_68" src="https://github.com/user-attachments/assets/e0095b7b-7bfc-44ad-8041-eb85d24f44a0" /><br>

&ensp;&ensp;插件管理器部署完成<br>























