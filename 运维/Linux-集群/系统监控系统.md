# 1.常见监控平台
## 1.1 Cacti
- 软件官方网站<br>
&ensp;&ensp;http://www.cacti.net/<br>
- 软件设计目标<br>
&ensp;&ensp;流量与性能监测为主<br>
- 数据展示平台<br>
&ensp;&ensp;B/S<br>
- 数据收集方式<br>
&ensp;&ensp;SNMP（Simple Network Management Protocol）<br>

## 1.2 Nagios
- 软件官方网站<br>
&ensp;&ensp;http://www.nagios.org/<br>
- 软件设计目标<br>
&ensp;&ensp;服务与性能监测为主<br>
- 数据展示平台<br>
&ensp;&ensp;B/S<br>
- 数据收集方式<br>
&ensp;&ensp;SNMP（Simple Network Management Protocol）<br>

## 1.3 Zabbix
- 软件官方网站<br>
&ensp;&ensp;http://www.zabbix.com/<br>
- 软件设计目标<br>
&ensp;&ensp;全功能监控软件<br>
- 数据展示平台<br>
&ensp;&ensp;B/S<br>
- 数据收集方式<br>
&ensp;&ensp;C/S<br>

# 2.监控平台搭建
## 2.1 Cacti 监控服务器
- 组件构成<br>
&ensp;&ensp;组合框架：LAP<br>
&ensp;&ensp;数据收集：SNMP <br>
&ensp;&ensp;绘制图形：RRDtool <br>
- SNMP 收集数据展示图<br>
<img width="507" height="267" alt="Linux：集群_57" src="https://github.com/user-attachments/assets/1ca75912-c7f3-436f-a4f4-6f62ea698bce" /><br>
- RRDtool<br>
&ensp;&ensp;官方定义<br>
&ensp;&ensp;&ensp;&ensp;RRDtool 是开源行业标准，高性能的时间序列数据记录和绘图系统。RRDtool 可以很容易地集成到 shell 脚本、perl、python、ruby、lua 或 tcl 应用程序中<br>
&ensp;&ensp;工作架构<br>
 <img width="332" height="224" alt="Linux：集群_58" src="https://github.com/user-attachments/assets/60410c1b-8dba-4d92-95da-d9ce6e80fc56" /><br>
&ensp;&ensp;C/S  模式<br>
&ensp;&ensp;&ensp;&ensp;采集监测数据<br>
&ensp;&ensp;B/S  模式<br>
&ensp;&ensp;&ensp;&ensp;管理监测数据<br>

## 2.2 cacti 监控搭建
- 监控端<br>
&ensp;&ensp;tar -xf cati.tar<br>
&ensp;&ensp;service iptables stop<br>
&ensp;&ensp;chkconfig iptables off<br>
&ensp;&ensp;yum -y install httpd mysql mysql-server mysql-devel libxml2-devel mysql-connector-odbc perl-DBD-MySQL unixODBC php php-mysql php-pdo   # 安装基础环境 LAMP<br>
&ensp;&ensp;yum -y install net-snmp net-snmp-utils net-snmp-libs lm_sensors  # 安装 SNMP、主板信息监控所需软件包<br>
&ensp;&ensp;service httpd start<br>
&ensp;&ensp;service mysqld start<br>
&ensp;&ensp;mysqladmin -uroot password “123456”<br>
&ensp;&ensp;安装rrdtools（软件包在服务器内）<br>
&ensp;&ensp;&ensp;&ensp;tar -zxf rrdtool-1.4.5.tar.gz<br>
&ensp;&ensp;&ensp;&ensp;cd rrdtool<br>
&ensp;&ensp;&ensp;&ensp;./configure –prefix=/usr/local<br>
&ensp;&ensp;&ensp;&ensp;如出错，按以下步骤解决,此版本需先出错再解决报错，不然安装不上 # 解决源码编译报错依赖<br>
&ensp;&ensp;&ensp;&ensp;cd ../<br>
&ensp;&ensp;&ensp;&ensp;tar zxvf cgilib-0.5.tar.gz<br>
&ensp;&ensp;&ensp;&ensp;cd cgilib-0.5<br>
&ensp;&ensp;&ensp;&ensp;make<br>
&ensp;&ensp;&ensp;&ensp;cp libcgi.a /usr/local/lib<br>
&ensp;&ensp;&ensp;&ensp;cp cgi.h /usr/include<br>
&ensp;&ensp;&ensp;&ensp;yum -y install libart_lgpl-devel pango-devel* cairo-devel* <br>
&ensp;&ensp;&ensp;&ensp;cd ../rrdtool<br>
&ensp;&ensp;&ensp;&ensp;./configure –prefix=/usr/local<br>
&ensp;&ensp;&ensp;&ensp;make && make install<br>
&ensp;&ensp;tar -zxf cacti-0.8.7g.tar.gz # 解压 Cacti 网站<br>
&ensp;&ensp;mv cacti-0.8.7g/ /var/www/html/cacti # 拷贝至 Apache 默认路径<br>
&ensp;&ensp;cd /var/www/html/cacti # 为 Cacti 代码进行补丁更新<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/data_source_deactivate.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/graph_list_view.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/html_output.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/ldap_group_authenication.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/script_server_command_line_parse.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/ping.patch<br>
&ensp;&ensp;&ensp;&ensp;patch -p1 -N <cacti 文件所在的绝对路径/cacti/poller_interval.patch<br>
&ensp;&ensp;useradd runct  # 添加 runct 用户，用于 RRDTOOL 运行<br>
&ensp;&ensp;chown -R root.root /var/www/html/cacti<br>
&ensp;&ensp;chown -R runct.runct rra/ log/ # 添加检测数据的用户账户，更改权限，保证读写数据正常<br>
&ensp;&ensp;mysql -u root -p # 授权数据库用户,导入初始化数据<br>
&ensp;&ensp;&ensp;&ensp;mysql> create database cactidb default character set utf8; # 创建 cactidb 数据库<br>
&ensp;&ensp;&ensp;&ensp;mysql> grant all on cactidb.* to ‘cactiuser’@’localhost’ identified by ‘123456（密码可以自己设置）’;  # 把 cactiuser 用户赋予 cactidb 库的所有权限<br>
&ensp;&ensp;&ensp;&ensp;mysql> exit<br>
&ensp;&ensp;&ensp;&ensp;mysql -u cactiuser -p cactidb < cacti.sql<br>
&ensp;&ensp;然后输入你给 cactiuser 用户设置的密码<br>
&ensp;&ensp;vim include/config.php #修改 cacti 配置文件，配置 cacti 页面连接数据库的认证信息<br>

```bash
$database_type = “mysql”;
$database_default = “cactidb（你创建的数据库名）”;
$database_hostname = “localhost”;
$database_username = “cactiuser”;
# 你创建的 mysql 的 cacti 用户名
$database_password = “123456789”;
# 你创建的 mysql 的 cacti 用户密码
$database_port = “3306”;
# 连接端口
```
&ensp;&ensp;vim /etc/httpd/conf/httpd.conf<br> # 配置 Apache 对 cacti 的用户权限<br>
&ensp;&ensp;&ensp;&ensp;Listen 80 # 监听端口<br>
<img width="492" height="137" alt="Linux：集群_60" src="https://github.com/user-attachments/assets/d9ac7652-2b1f-454b-9fab-f1c18facd508" /><br>
&ensp;&ensp;&ensp;&ensp;DocumentRoot "/var/www/html/cacti" # 调整 Apache 默认加载路径<br>
<img width="515" height="82" alt="Linux：集群_61" src="https://github.com/user-attachments/assets/a71ce0dd-9d13-4ed6-988c-8f33ffeb462f" /><br>
&ensp;&ensp;<Directory "/var/www/html/cacti"><br>
<img width="438" height="52" alt="Linux：集群_62" src="https://github.com/user-attachments/assets/80d43f2f-2671-4656-b855-7fe89e55f3ee" /><br>
&ensp;&ensp;DirectoryIndex index.php index.html index.html.var # 修改默认加载选项<br>
<img width="475" height="85" alt="Linux：集群_63" src="https://github.com/user-attachments/assets/4ceb34fc-2889-4c9e-ad6b-42d772591b4a" /><br>
&ensp;&ensp;AddDefaultCharset utf-8<br>
&ensp;&ensp;service httpd restart
&ensp;&ensp;然后再浏览器输入 http://cacti 监控端 IP 地址/install 进行安装<br>

- 被监控端<br>
&ensp;&ensp;yum -y install net-snmp net-snmp-utils lm_sensors # 安装 SNMP、主板信息监控所需软件包<br>
&ensp;&ensp;vim /etc/snmp/snmpd.conf # 修改 snmp 配置文件<br>
&ensp;&ensp;修改共同体名称<br>
<img width="359" height="53" alt="Linux：集群_64" src="https://github.com/user-attachments/assets/507bb149-eaeb-43a7-a4e2-a01b808675b0" /><br>

&ensp;&ensp;开放所有的 SNMP 查询权限 all 默认为 SystemView<br>
<img width="551" height="41" alt="Linux：集群_65" src="https://github.com/user-attachments/assets/b139ee39-10ef-4bc1-b0e1-f02c03806460" /><br>

&ensp;&ensp;支持各种查询与访问，取消注释符号<br>
<img width="435" height="31" alt="Linux：集群_66" src="https://github.com/user-attachments/assets/cc719bda-9b75-4cf8-ada4-f22474c5e357" /><br>

- 回到监控端<br>
&ensp;&ensp;snmpwalk -v 2c -c public123（共同体名称） 10.10.10.12（被监控端 IP 地址） tcp<br>
&ensp;&ensp;php /var/www/html/cacti/poller.php # 生成对应的监控图表<br>
&ensp;&ensp;crontab -e<br>
&ensp;&ensp;*/5 * * * * /usr/bin/php /var/www/html/cacti/poller.php &>/dev/null # 配置 RRDTOOL 的轮训任务<br>
&ensp;&ensp;service crond start<br>

- Cacti 部署插件管理器<br>
&ensp;&ensp;cd /root/cacti-plugin（cicti.tar 文件解压的位置）<br>
&ensp;&ensp;tar -xf cacti-plugin-0.8.7g-PA-v2.8.tar.gz<br>
&ensp;&ensp;cd cacti-plugin-arch/<br>
&ensp;&ensp;mysql -uroot -p cactidb < pa.sql<br>
&ensp;&ensp;cd /var/www/html/cacti/<br>
&ensp;&ensp;patch -p1 -N </root/cacti-plugin（cicti.tar 文件解压的位置）/cacti-plugin-arch/cacti-plugin-0.8.7g-PA-v2.8.diff<br>
&ensp;&ensp;插件文件存放位置：/var/www/html/cacti/plugins<br>
&ensp;&ensp;浏览器登录 cacti 网页管理器<br>
&ensp;&ensp;&ensp;&ensp;点击 Console 然后 再点击 User Management<br>
<img width="266" height="591" alt="Linux：集群_67" src="https://github.com/user-attachments/assets/86d1f537-683e-49a8-9d35-62e2d3fe6f2e" /><br>

&ensp;&ensp;勾选 Plugin Management<br>
<img width="930" height="815" alt="Linux：集群_68" src="https://github.com/user-attachments/assets/e0095b7b-7bfc-44ad-8041-eb85d24f44a0" /><br>

&ensp;&ensp;插件管理器部署完成<br>


## 2.3 Nagios 监控服务器
- 老牌监控服务器 Cacti – Nagios 对比<br>
&ensp;&ensp;Cacti<br>
&ensp;&ensp;&ensp;&ensp;收集数据、图形展示<br>
&ensp;&ensp;&ensp;&ensp;偏重网络流量<br>
&ensp;&ensp;&ensp;&ensp;SNMP、OID、SNMP Agent<br>
&ensp;&ensp;Nagio<br>
&ensp;&ensp;&ensp;&ensp;偏重主机、服务的状态<br>
&ensp;&ensp;&ensp;&ensp;Agent<br>
&ensp;&ensp;&ensp;&ensp;脚本<br>
- Nagios 健康对象类划分<br>
&ensp;&ensp;主机、主机组<br>
&ensp;&ensp;服务/资源，服务组<br>
&ensp;&ensp;联系人，联系人组<br>
&ensp;&ensp;时段<br>
&ensp;&ensp;命令<br>
- Nagios 收集数据架构图<br>
<img width="484" height="313" alt="Linux：集群_69" src="https://github.com/user-attachments/assets/5b5254ac-4f5b-4c54-9436-77507c780014" /><br>

- Nagios 整体框架图<br>
<img width="452" height="271" alt="Linux：集群_70" src="https://github.com/user-attachments/assets/c830e2b4-285e-43ac-95df-389113800747" /><br>

## 2.4 Nagios 监控搭建
- 监控端搭建<br>
&ensp;&ensp;yum -y install httpd gcc glibc *gd* glibc-common php php-mysql # 解决安装 Nagios 的依赖关系<br>
&ensp;&ensp;groupadd nagcmd # 创建运行组<br>
&ensp;&ensp;useradd -m nagios #  创建运行用户 nagios<br>
&ensp;&ensp;usermod -a -G nagcmd nagios #  将 nagios  用户添加到 nagcmd  组中<br>
&ensp;&ensp;usermod -a -G nagcmd apache #  将 apache  用户添加到 nagcmd 组中<br>
&ensp;&ensp;wget https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.4.6.tar.gz<br>
&ensp;&ensp;tar zxf nagios-3.1.2.tar.gz # 解压 Nagios 源码包<br>
&ensp;&ensp;cd nagios-3.1.2<br>

```bash
./configure –with-command-group=nagcmd –enable-event-broker # 生成 Nagios Makefile 文件
make all
make install
make install-init
make install-config
make install-commandmode

```
&ensp;&ensp;vi /usr/local/nagios/etc/objects/contacts.cfg<br>

```bash
email      nagios@localhost
# 监控要发送邮件的地址，这个是默认设置
```

&ensp;&ensp;make install-webconf<br>
&ensp;&ensp;htpasswd -c /usr/local/nagios/etc/htpasswd.users nagiosadmin<br>
&ensp;&ensp;service httpd restart<br>
&ensp;&ensp;tar zxf nagios-plugins-1.4.15.tar.gz<br>
&ensp;&ensp;cd nagios-plugins-1.4.15<br>

```bash
./configure –with-nagios-user=nagios –with-nagios-group=nagios –with-mysql –enable-perl-modules
make
make install
```

&ensp;&ensp;chkconfig –add nagios<br>
&ensp;&ensp;chkconfig nagios on<br>
&ensp;&ensp;/usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg<br>
&ensp;&ensp;service nagios start<br>
&ensp;&ensp;浏览器输入 https://nagios 服务器 IP 地址/nagios<br>


- 配置 windos 端监控<br>
&ensp;&ensp;被监控端安装 NSClient++-0.3.8-Win32.msi<br>
&ensp;&ensp;安装完成后修改配置文件 NSC.ini 把需要的库都打开<br>
&ensp;&ensp;在监控服务器上修改 nagios 配置文件 nagios.cfg<br>
```bash
define host{
use  windows-server    # Inherit default values from a template
host_name            winserver            # The name we’re giving to this host
alias My Windows Server    # A longer name associated with the host
address                10.10.10.11     # 你主机的 IP
```

- 配置 linux 端监控<br>
&ensp;&ensp;useradd nagios # 创建用户<br>
&ensp;&ensp;tar -zxf nagios-plugins-1.4.15.tar.gz # 为了安装 nrpe，先安装 nagios-plugins-1.4.15.tar.gz 插件<br>
&ensp;&ensp;cd nagios-plugins-1.4.15<br>
```bash
 ./configure –with-nagios-user=nagios –with-nagios-group=nagios
make all
make install
```

&ensp;&ensp;tar -zxvf nrpe-2.12.tar.gz # 安装 nrpe<br>
&ensp;&ensp;cd nrpe-2.12.tar.gz<br>

```bash
 ./configure –enable-ssl –with-ssl-lib=/usr/lib64/
make all
make install-plugin
make install-daemon
make install-daemon-config
```

&ensp;&ensp;vim /usr/local/nagios/etc/nrpe.cfg # 配置 nrpe 信息<br>

```bash
 allowed_hosts=192.168.216.251,127.0.0.1
```

&ensp;&ensp;/usr/local/nagios/bin/nrpe -c /usr/local/nagios/etc/nrpe.cfg –d<br>
&ensp;&ensp;cd nagios-nrpe_2.8.1 # 服务端安装 nrpe 插件<br>

```bash
./configure –enable-ssl –with-ssl-lib=/usr/lib64/
make all
make install-plugin
```

&ensp;&ensp;vi /usr/local/nagios/etc/objects/commands.cfg # commands.cfg 定义外部构件 nrpe<br>

```bash
define command{
command_name check_nrpe
command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c $ARG1$
}
定义 mylinux.cfg
define host{
use                       linux-server
host_name    mylinux/IP
alias                     mylinux
address  192.168.0.27(客户端 IP 既被监控的IP）
}
define service{
use                        generic-service
host_name           mylinux
service_description      check-load
check_command              check_nrpe!check_load
}
define service{
use                           generic-service
host_name               mylinux
service_description      check-users
check_command          check_nrpe!check_users
}
define service{
use                            generic-service
host_name            mylinux
service_description    otal_procs
check_command       check_nrpe!check_total_procs
}
```

## 2.5 Zabbix 监控服务器
- Zabbix 是什么？<br>
&ensp;&ensp;zabbix是一个基于WEB 界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案( 基于 GPL V2 )<br>
&ensp;&ensp;zabbix由2部分构成，zabbix server 与可选组件 zabbix agent<br>
- Zabbix 工作架构<br>
<img width="524" height="384" alt="Linux：集群_71" src="https://github.com/user-attachments/assets/d1980a49-fdea-4ec9-aadb-bfdc82425e11" /><br>
- Zabbix 进程构成<br>
&ensp;&ensp;zabbix 安装完成后会产生 5 个程序<br>
&ensp;&ensp;zabbix_agentd<br>
&ensp;&ensp;&ensp;&ensp;客户端守护进程，此进程收集客户端数据，例如 cpu 负载、内存、硬盘使用情况等<br>
&ensp;&ensp;zabbix_get<br>
&ensp;&ensp;&ensp;&ensp;zabbix 工具，单独使用的命令，通常用于排错<br>
&ensp;&ensp;zabbix_proxy<br>
&ensp;&ensp;&ensp;&ensp;zabbix 工具，用于发送数据给 server  或者 proxy  ，在脚本完成之后使用 sender 主动将数据提交<br>
&ensp;&ensp;zabbix_sender<br>
&ensp;&ensp;&ensp;&ensp;zabbix 服务端守护进程，所有的数据都是被提交或主动提交到 zabbix_server 端<br>
&ensp;&ensp;zabbix_server<br>
&ensp;&ensp;&ensp;&ensp;zabbix 代理守护进程。功能类似 server，唯一不同的是它只是一个中转站，它需要把收集到的数据提交/被提交到 server 里<br>
&ensp;&ensp;zabbix_java_gateway：可选，这个需要另外安装<br>
&ensp;&ensp;&ensp;&ensp;zabbix2.0 之后引入的一个功能。顾名思义：Java 网关，类似 agentd，但是只用于 Java 方面。需要特别注意的是，它只能主动去获取数据，而不能被动获取数据。它的数据最终会给到 server 或者 proxy<br>
- Zabbix 硬件需求<br>
<img width="608" height="97" alt="Linux：集群_72" src="https://github.com/user-attachments/assets/4162b1c7-2d44-4d03-8e8c-fd32d1b9571d" /><br>

## 2.6 Zabbix 监控服务搭建
### 2.6.1 zabbix 3.2 版本安装
- 监控端构建<br>
&ensp;&ensp;环境<br>
&ensp;&ensp;&ensp;&ensp;系统：Centos 7<br>
&ensp;&ensp;&ensp;&ensp;zabbix 3.2 版本<br>
&ensp;&ensp;&ensp;&ensp;zabbix 3.2 官方 rpm 源http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm<br>
&ensp;&ensp;systemctl stop firewalld<br>
&ensp;&ensp;systemctl disable firewalld<br>
&ensp;&ensp;sed -i ‘s/SELINUX=enforcing/SELINUX=disabled/’ /etc/selinux/config # 配置文件关闭 SELinux，但需要重启才生效<br>
&ensp;&ensp;setenforce 0 # 临时关闭 SELinux，不需要重启<br>
&ensp;&ensp;yum -y install mariadb mariadb-server httpd php php-mysql<br>
&ensp;&ensp;systemctl enable httpd<br>
&ensp;&ensp;systemctl restart httpd<br>
&ensp;&ensp;systemctl enable mariadb<br>
&ensp;&ensp;systemctl restart mariadb<br>
&ensp;&ensp;mysql_secure_installation # 初始化数据库<br>
&ensp;&ensp;mkdir /zabbix # 创建一个文件夹存放 zabbix rpm 包<br>
&ensp;&ensp;去 http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/ 下载五个文件<br>
&ensp;&ensp;&ensp;&ensp;zabbix-agent-3.2.9-1.el7.x86_64.rpm<br>
&ensp;&ensp;&ensp;&ensp;zabbix-get-3.2.9-1.el7.x86_64.rpm<br>
&ensp;&ensp;&ensp;&ensp;zabbix-server-mysql-3.2.9-1.el7.x86_64.rpm<br>
&ensp;&ensp;&ensp;&ensp;zabbix-web-3.2.9-1.el7.noarch.rpm<br>
&ensp;&ensp;&ensp;&ensp;zabbix-web-mysql-3.2.9-1.el7.noarch.rpm<br>
&ensp;&ensp;将下载的五个文件上传到 /zabbix<br>
&ensp;&ensp;cd /zabbix<br>
&ensp;&ensp;rpm -ivh http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm<br>
&ensp;&ensp;yum -y install * <br>
&ensp;&ensp;mysql -u root -p # 登录数据库创建 zabbix 要使用的数据库<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]> create database zabbix（数据库名字） character set utf8 collate utf8_bin; # 创建 zabbix 数据库，并且使用 utf8 编码<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]>create database zabbix character set utf8 collate utf8_bin;<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]>create user zabbix（zabbix 软件数据库用户名）@localhost identified by ‘123456（用户密码）’;<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]>create user zabbix@localhost identified by '123456';<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]>grant all privileges on zabbix.* to zabbix@localhost; # 将 zabbix 数据库授权给 zabbix 用户<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]>exit<br>
&ensp;&ensp;vim /etc/zabbix/zabbix_server.conf # 修改 zabbix 配置文件<br>

```bash
将下面选项取消注释并修改成下面这样
DBHost=localhost
DBName=zabbix（数据库名称）
DBUser=zabbix（数据库用户名）
DBPassword=123456（数据库用户密码）
```

&ensp;&ensp;cd /usr/share/doc/zabbix-server-mysql-3.2.9<br>
&ensp;&ensp;zcat create.sql.gz | mysql -uroot -p zabbix # 将 zabbix 所需数据库 create.sql.gz 还原到你所创建的 zabbix 库中<br>
&ensp;&ensp;解决 zabbix 中文乱码问题<br>
&ensp;&ensp;在 windows 下 使用 Win+R 输入 fonts 拷贝微软雅黑字体改名为 graphfont.ttf<br>
&ensp;&ensp;cd /usr/share/zabbix/fonts/<br>
&ensp;&ensp;mv graphfont.ttf graphfont.ttf.back<br>
&ensp;&ensp;将 windows 微软雅黑字体改名为 graphfont.ttf 的文件上传到这个文件夹即可<br>
&ensp;&ensp;systemctl start zabbix-server<br>
&ensp;&ensp;systemctl enable zabbix-server<br>
&ensp;&ensp;vim /etc/httpd/conf.d/zabbix.conf # 编辑 zabbix  前端 php 配置<br>
&ensp;&ensp;修改 <IfModule mod_php5.c> 标签<br>
```bash
php_value max_execution_time 300
php_value memory_limit 128M
php_value post_max_size 16M
php_value upload_max_filesize 2M
php_value max_input_time 300
php_value always_populate_raw_post_data -1
php_value date.timezone Asia/Shanghai
# 修改你服务器所在地的时区，不修改无法进入 zabbix 网页管理页面
```

&ensp;&ensp;yum -y install ntpdate && ntpdate cn.pool.ntp.org # 调整时间同步（一般生产环境建议搭建时间服务器）<br>
&ensp;&ensp;systemctl restart httpd<br>
&ensp;&ensp;浏览器输入 http://10.10.10.17/zabbix 配置zabbix<br>


- 被监控端搭建
&ensp;&ensp;service iptables stop<br>
&ensp;&ensp;chkconfig iptables off<br>
&ensp;&ensp;sed -i ‘s/SELINUX=enforcing/SELINUX=disabled/’ /etc/selinux/config # 配置文件关闭 SELinux，但需要重启才生效<br>
&ensp;&ensp;setenforce 0 # 临时关闭 SELinux，不需要重启<br>
&ensp;&ensp;去 http://repo.zabbix.com/zabbix/3.2/rhel/6/x86_64/ 下载 zabbix-agent-3.2.9-1.el6.x86_64.rpm # 如果被监控端是 centos 7 就去<br> &ensp;&ensp;http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/ 下载<br>
&ensp;&ensp;然后上传到被监控端<br>
&ensp;&ensp;yum -y install zabbix-agent-3.2.9-1.el6.x86_64.rpm<br>
&ensp;&ensp;vim /etc/zabbix/zabbix_agentd.conf<br>
&ensp;&ensp;修改<br>
&ensp;&ensp;Server=10.10.10.17（zabbix 监控端 IP 地址）<br>
<img width="763" height="162" alt="Linux：集群_75" src="https://github.com/user-attachments/assets/011bedcb-7568-416f-909c-b6ed5027300f" /><br>

&ensp;&ensp;ServerActive=10.10.10.17（zabbix 监控端 IP 地址）<br>
<img width="729" height="201" alt="Linux：集群_76" src="https://github.com/user-attachments/assets/9074ead4-0930-4051-9b20-16934564505f" /><br>

&ensp;&ensp;Hostname=web-server-1（主机名，不要和其他主机重复）<br>
<img width="623" height="155" alt="Linux：集群_77" src="https://github.com/user-attachments/assets/e3f98acc-0b3e-49d1-9b70-9ccabb3d4b86" /><br>

&ensp;&ensp;service zabbix-agent start<br>
&ensp;&ensp;chkconfig zabbix-agent on<br>


###  zabbix 5.0版本安装
- 环境<br>
&ensp;&ensp;系统：Centos 7<br>
&ensp;&ensp;zabbix 5.0 版本<br>
&ensp;&ensp;5.0 版本对基础环境的要求有大的变化，最大的就是对 php 版本的要求，最低要求 7.2.0 版本<br>
- 监控端构建<br>
&ensp;&ensp;sed -i ‘s/SELINUX=enforcing/SELINUX=disabled/’ /etc/selinux/config # 配置文件关闭 SELinux，但需要重启才生效<br>
&ensp;&ensp;setenforce 0 # 临时关闭 SELinux，不需要重启<br>
&ensp;&ensp;systemctl stop firewalld # 关闭防火墙<br>
&ensp;&ensp;systemctl disable firewalld # 关闭防火墙开机自启<br>
&ensp;&ensp;rpm -Uvh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm # 下载 zabbix rpm 源<br>
&ensp;&ensp;sed -i 's#http://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#' /etc/yum.repos.d/zabbix.repo # 将 zabbix rpm 源更换为阿里云 zabbix rpm 源<br>
&ensp;&ensp;yum clean all<br>
&ensp;&ensp;yum install zabbix-server-mysql zabbix-agent -y<br>
&ensp;&ensp;yum install centos-release-scl -y # 安装 Software Collections，便于后续安装高版本的 php，默认 yum 安装的 php 版本为 5.4 过低<br>
&ensp;&ensp;vim /etc/yum.repos.d/zabbix.repo<br>
&ensp;&ensp;将 [zabbix-frontend] 下的 enabled 改为 由 0 改为 1<br>
&ensp;&ensp;yum install zabbix-web-mysql-scl zabbix-apache-conf-scl -y # 安装 zabbix 前端和相关环境<br>
&ensp;&ensp;yum install mariadb-server -y 安装数据库<br>
&ensp;&ensp;systemctl enable mariadb # 配置数据库开机自动启动<br>
&ensp;&ensp;systemctl start mariadb # 启动数据库<br>
&ensp;&ensp;mysql_secure_installation # 初始化 mariadb 并配置 root 密码<br>
&ensp;&ensp;mysql -uroot -p # 进入 mariadb 数据库<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]> create database zabbix（数据库名字） character set utf8 collate utf8_bin; # 创建 zabbix 数据库，并且使用 utf8 编码<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]> create database zabbix character set utf8 collate utf8_bin;<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]> create user zabbix（zabbix 软件数据库用户名）@localhost identified by ‘password（用户密码）’;<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]> create user zabbix@localhost identified by ‘password’;<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]> grant all privileges on zabbix.* to zabbix@localhost; # 将 zabbix 数据库授权给 zabbix 用户<br>
&ensp;&ensp;&ensp;&ensp;MariaDB [(none)]> exit<br>
&ensp;&ensp;zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix # 导入 zabbix 数据库，zabbix 数据库用户为 zabbix，密码为 password<br>
&ensp;&ensp;vim /etc/zabbix/zabbix_server.conf  # 修改 zabbix 配置文件<br>
```bash
将 DBPassword= 取消注释并改为 DBPassword=password
```

&ensp;&ensp;vim /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf # 修改 zabbix 的 php 配置文件里的时区<br>
&ensp;&ensp;将php_value[date.timezone] = 取消注释并修改为 php_value[date.timezone] = Asia/Shanghai<br>
&ensp;&ensp;systemctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm # 启动以上服务<br>
&ensp;&ensp;systemctl enable zabbix-server zabbix-agent httpd rh-php72-php-fpm # 将以上服务器设置为开机自启<br>




