# 系统安全防御
## 1.常见攻击手段
- 拒绝服务（DOS）
  - 通过大量访问请求使服务器资源耗尽，无法向正常用户处理请求连接
  - 常见解决手段：使用云服务商的流量清洗功能
- 口令破解
  - 常用攻击手法俗称“跑字典”
  - 常用解决方案：设置登录错误次数限制
- 已知漏洞
  - 通过已知漏洞进行数据获取或提权
  - 常用解决方案：定时更新防御性补丁
- 欺骗权限用户
  - 又称社会工程学，通过欺骗权限用户得到授权资格的方式

## 2.常见的安全防御设备
- 基础类防火墙：主要实现包过滤防火墙
- IDS 类防火墙：入侵检测系统，提供报告和事后监督为主
- IPS 类防火墙：入侵防御系统，分析数据包内容，根据模式匹配去阻断非法访问
- 主动安全类防火墙：对特定服务类型进行专项防御，常见设备有waf、daf

## 3.基础类防护墙
- 什么是防火墙
  - 工作在主机边缘或者网络边缘处对数据报文进行检测，并且能够根据事先定义好的规则，对数据报文进行相应处理的模块
- 防火墙的分类
  - 结构
    - 软件：iptables
    - 硬件：深信服 、 网御 、 华为
  - 工作机制
    - 包过滤防火墙：源地址、目的地址、源端口、目标端口、连接状态
    - 应用层防火墙：URL
  - 模块
    - 内核态：netfilter
    - 用户态：iptables
- Iptables 工作结构<br>
 <img width="476" height="337" alt="系统安全-01" src="https://github.com/user-attachments/assets/428b32a4-af69-489a-9bcf-6759eece96bc" /><br>

- Iptables 经历的构造变化<br>
 <img width="533" height="181" alt="系统安全-02" src="https://github.com/user-attachments/assets/ab3d301f-6fb6-4ae6-b5b1-5864d11e211c" /><br>

- 四表五链
    - 四表（规则表）
      - raw：状态跟踪
      - mangle：标记
      - nat：实现地址转换
      - filter：过滤
  - 五链（规则链）
      - 入站：INPUT
      - 出站：OUTPUT
      - 转发：FORWARD
      - 路由前应用规则：修改目标地址 PREROUTING
      - 路由后应用规则：修改源地址 POSTROUTING
  - 防火墙链表结构<br>
  <img width="558" height="294" alt="系统安全-03" src="https://github.com/user-attachments/assets/f9ec9305-438d-4cbf-990e-8cbe3d459ef1" /><br>
  
- 防火墙相关顺序
  - 规则匹配顺序：由上至下，匹配即停止
  - 表应用顺序：raw>mangle>nat>filter
  - 链应用顺序
    - 入站：PREROUTING>INPUT
    - 出站：OUTPUT>POSTROUTING
    - 转发：PREROUTING>FORWARD>POSTROUTING
- 链表匹配顺序示意图<br>
<img width="538" height="278" alt="系统安全-04" src="https://github.com/user-attachments/assets/2815c94c-0b7c-4e77-8fba-b02306eab8a1" /><br>
  - 入站数据流向
    - 网络A > raw:PREROUTING > mangle:PREROUTING > nat:PREROUTING > 路由选择 > mangle:INPUT > filter:INPUT > 本机的应用进程
  - 出站数据流向
    - 本机的应用进程 > 路由选择 > raw:OUTPUT > mangle:OUTPUT > nat:OUTPUT > filter:OUTPUT > mangle:POSTROUTING > nat:POSTROUTING > 网络B
  - 转发数据流向
    - 网络A > raw:PREROUTING > mangle:PREROUTING > nat:PREROUTING > 路由选择 > mangle:FORWARD > filter: FORWARD > mangle:POSTROUTING > nat:POSTROUTING > 网络B

## 4.Iptables 语法规则
- 书写规则
  - 语法构成：iptables   [-t 表名]   选项  [链名]   [条件]   [-j 控制类型]
  - 注意事项
    - 不指定表名时，默认指 filter 表
    - 不指定链名时，默认指表内的所有链
    - 除非设置链的默认策略，否则必须指定匹配条件
    - 选项、链名、控制类型使用大写字母，其余均为小写
- 常见选项<br>
<img width="612" height="353" alt="系统安全-05" src="https://github.com/user-attachments/assets/99ae0552-b453-4407-9d38-d1ef6259891e" /><br>
- 常见动作类型
  - ACCEPT：允许通过
  - DROP：直接丢弃，不给出任何回应
  - REJECT：拒绝通过，必要时会给出提示
  - LOG：记录日志信息，然后传给下一条规则继续匹配
  - SNAT：修改数据包源地址
  - DNAT：修改数据包目的地址
  - REDIRECT：重定向
- 代码演示示例

```bash
iptables -t filter -L
# 查看过滤表中的所有规则链
iptables -t filter -A INPUT -p tcp -j ACCEPT
# 当 TCP 协议请求入站允许通过，并且把这条规则放在规则链的最下方
iptables -t filter -L -n
# 以数字形式显示过滤表中的所有规则链
iptables -t filter -L -n -v
# 以数字形式显示过滤表中的所有规则链并且显示过滤报文条数和过滤报文包的字节大小，以便查看那条规则过滤信息较多，方便把这条规则放在规则链上方，提高效率
iptables -t filter -I INPUT -p udp -j ACCEPT
# 当 UDP 协议请求入站允许通过，并且把这条规则放在规则链的最上方
iptables -t filter -I INPUT 2 -p icmp -j ACCEPT
# 当 ICMP 协议请求入站允许通过，并且把这条规则放在规则链的第二条
iptables -t filter -L –line-numbers
# 查看过滤表中的所有规则链,并且在规则链前方添加序号
iptables -t filter -D INPUT 4
# 删除过滤表中的入站规则链的第四条规则
iptables -t filter -F
# 删除过滤表的所有规则
iptables -t filter -I INPUT -p tcp -j ACCEPT –dport 22
# 当 TCP 协议请求通过 22 端口入站允许通过，并且把这条规则放在规则链的第一条
iptables -t filter -I INPUT -p tcp -j ACCEPT –dport 80
# 当 TCP 协议请求通过 80 端口入站允许通过，并且把这条规则放在规则链的第一条
iptables -t filter -P INPUT DROP
# 修改过滤表中的入站规则链的默认规则为 DROP（直接丢弃，不给出任何回应）
```




































